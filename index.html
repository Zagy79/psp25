<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Plakát</title>
  <style>
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; overflow: hidden; }
    body {
      min-height: 100vh;
      min-height: 100dvh;
      min-height: 100svh;
      display: grid;
      place-items: center;
      background: #000;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      color: #e8ecf1;
    }
    figure { margin: 0; }
    img {
      display: block;
      max-width: 100vw;
      max-height: 100dvh;
      height: auto;
      width: auto;
      object-fit: contain;
      border-radius: 8px;
      box-shadow: 0 10px 30px rgba(0,0,0,.5);
    }
    .dl {
      position: fixed; right: 12px; bottom: 12px;
      padding: 8px 12px; border-radius: 8px;
      color: #fff; text-decoration: none;
      background: rgba(255,255,255,.12);
      -webkit-backdrop-filter: blur(6px); backdrop-filter: blur(6px);
      font: 500 14px/1 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }

    /* QR platba v plovoucím panelu */
    .qr-wrap{
      position: fixed; right: 12px; bottom: 60px; /* nad tlačítkem Stáhnout plakát */
      display: grid; gap: 6px; place-items: center;
      background: rgba(15,17,24,.7);
      -webkit-backdrop-filter: blur(8px); backdrop-filter: blur(8px);
      padding: 10px; border-radius: 12px;
      border: 1px solid rgba(255,255,255,.12);
    }
    .qr{
      width: clamp(120px, 22vw, 240px);
      aspect-ratio: 1/1;
      display: grid; place-items: center;
    }
    .qr-actions{
      display: flex; gap: 8px; align-items: center;
      font-size: 12px; color: #cdd6e0;
    }
    .btn{
      appearance: none; cursor: pointer;
      padding: 6px 10px; border-radius: 8px;
      border: 1px solid rgba(255,255,255,.16);
      background: #151826; color: #fff; font-weight: 600; font-size: 12px;
    }
    .meta{
      font-size: 10px; color: #9aa3b2; max-width: 240px; word-break: break-all; text-align: center;
    }
    @media (max-width:480px){
      .qr-wrap{ right: 8px; bottom: 56px; padding: 8px }
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"
          integrity="sha512-JWx8nGZ9gC5W0v7x1KOCV3wYt2zq4Rz5Qb7Q9sSNK4f8vWgE5bRr7n8rE56+z7Dq4X3Z5YpQ2Vb1q4KfRNZ0Zg=="
          crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
  <figure>
    <img src="plakat.png" alt="Plakát" loading="lazy">
  </figure>
  <a class="dl" href="plakat.png" download>Stáhnout</a>

  <!-- QR PLATBA PANEL -->
  <div class="qr-wrap" aria-label="QR platba">
    <div id="qr" class="qr"></div>
    <div class="qr-actions">
      <button id="dlQR" class="btn" type="button">Stáhnout QR</button>
      <button id="copySPD" class="btn" type="button">Kopírovat SPD</button>
    </div>
    <div id="spd" class="meta"></div>
  </div>

<script>
/** Nastav zde platební údaje **/
const PAYMENT = {
  iban: 'CZ6508000000192000123456', // IBAN příjemce – bez mezer
  amount: '1500.00',                // částka, tečka jako desetinný oddělovač
  cc: 'CZK',                        // měna
  vs: '2025001',                    // variabilní symbol (volitelné)
  ss: '',                           // specifický symbol (volitelné)
  ks: '',                           // konstantní symbol (volitelné)
  msg: 'Podpora projektu',          // zpráva pro příjemce (volitelné, ~60 znaků)
  dt: ''                            // splatnost YYYY-MM-DD (volitelné)
};

// ===== Helpers =====
function normalizeIBAN(v){ return (v||'').toUpperCase().replace(/[^A-Z0-9]/g,''); }
function decAmount(v){
  if(!v) return '';
  const n = Number(v); if(!isFinite(n) || n<=0) return '';
  return n.toFixed(2);
}
function esc(v){ return String(v||'').replace(/[\r\n]+/g,' ').slice(0,60); }
function buildSPD(d){
  const p = ['SPD*1.0'];
  const iban = normalizeIBAN(d.iban); if(!iban) return '';
  p.push('ACC:'+iban);
  const amt = decAmount(d.amount); if(amt) p.push('AM:'+amt);
  p.push('CC:'+(d.cc||'CZK').toUpperCase());
  if(d.vs) p.push('X-VS:'+String(d.vs).replace(/\D/g,'').slice(0,10));
  if(d.ss) p.push('X-SS:'+String(d.ss).replace(/\D/g,'').slice(0,10));
  if(d.ks) p.push('X-KS:'+String(d.ks).replace(/\D/g,'').slice(0,4));
  if(d.msg) p.push('MSG:'+esc(d.msg));
  if(d.dt)  p.push('DT:'+d.dt);
  return p.join('*');
}

// ===== Render QR =====
let qr;
function renderQR(text){
  const box = document.getElementById('qr');
  const spdEl = document.getElementById('spd');
  box.innerHTML = '';
  if(!text){
    spdEl.textContent = 'Chybí IBAN pro QR platbu.';
    return;
  }
  qr = new QRCode(box, {
    text,
    width: Math.floor(box.clientWidth),
    height: Math.floor(box.clientWidth),
    correctLevel: QRCode.CorrectLevel.M
  });
  spdEl.textContent = text;
}

function downloadQR(){
  const box = document.getElementById('qr');
  const canvas = box.querySelector('canvas');
  const img = box.querySelector('img');
  let dataURL;
  if(canvas){
    dataURL = canvas.toDataURL('image/png');
  } else if(img){
    const c = document.createElement('canvas');
    c.width = img.naturalWidth; c.height = img.naturalHeight;
    const ctx = c.getContext('2d');
    ctx.drawImage(img,0,0);
    dataURL = c.toDataURL('image/png');
  }
  if(!dataURL) return;
  const a = document.createElement('a');
  a.href = dataURL; a.download = 'qr-platba.png';
  document.body.appendChild(a); a.click(); a.remove();
}

async function copySPD(){
  const text = document.getElementById('spd').textContent || '';
  try{
    await navigator.clipboard.writeText(text);
    toast('Zkopírováno');
  }catch(e){ toast('Nepodařilo se zkopírovat'); }
}

let toastTid;
function toast(msg){
  clearTimeout(toastTid);
  let t = document.getElementById('toast');
  if(!t){
    t = document.createElement('div');
    t.id = 'toast';
    Object.assign(t.style, {
      position:'fixed', left:'50%', bottom:'20px', transform:'translateX(-50%)',
      background:'rgba(0,0,0,.7)', color:'#fff', padding:'8px 12px',
      borderRadius:'10px', border:'1px solid rgba(255,255,255,.12)',
      font:'600 12px/1.2 system-ui,-apple-system,Segoe UI,Roboto,Inter',
      zIndex: 9999, backdropFilter:'blur(8px)', WebkitBackdropFilter:'blur(8px)'
    });
    document.body.appendChild(t);
  }
  t.textContent = msg; t.style.opacity = '1';
  toastTid = setTimeout(()=>{ t.style.opacity='0'; }, 1200);
}

// Init
const SPD = buildSPD(PAYMENT);
renderQR(SPD);

// Responsivní re-render při změně velikosti (debounce)
let rT;
window.addEventListener('resize', ()=>{
  clearTimeout(rT);
  rT = setTimeout(()=>renderQR(SPD), 150);
});
document.getElementById('dlQR').addEventListener('click', downloadQR);
document.getElementById('copySPD').addEventListener('click', copySPD);
</script>
</body>
</html>
