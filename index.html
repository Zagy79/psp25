<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vstupenky – QR platba</title>
  <style>
    :root{ --bg:#0b0b10; --txt:#e8ecf1; --muted:#9aa3b2; --card:#12131a; }
    *{box-sizing:border-box}
    html, body{margin:0; padding:0; background:var(--bg); color:var(--txt); font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
    a{color:inherit; text-decoration:none}

    /* Sekce 1 – plakát */
    .hero{ min-height:100svh; display:grid; place-items:center; background:#000; }
    .hero img{
      display:block; max-width:100vw; max-height:100svh; width:auto; height:auto; object-fit:contain;
      border-radius:10px; box-shadow:0 20px 60px rgba(0,0,0,.5);
    }

    /* Sekce 2 – cena + výběr */
    .panel{
      padding:28px 16px; display:grid; place-items:center;
      background: radial-gradient(1200px 700px at 70% -10%, #1a2238 0%, var(--bg) 50%);
      border-top:1px solid rgba(255,255,255,.06);
    }
    .card{
      width:min(900px,100%);
      background: color-mix(in srgb, var(--card) 90%, black 10%);
      border:1px solid rgba(255,255,255,.08);
      border-radius:18px; padding:18px; box-shadow:0 20px 50px rgba(0,0,0,.35);
    }
    h1{margin:6px 0 8px; font-size:clamp(22px,2.4vw,30px)}
    p.lead{margin:0 0 10px; color:var(--muted)}
    label{display:block; font-size:14px; color:var(--muted); margin-bottom:6px}
    select{
      width:100%; padding:12px 14px; border-radius:12px;
      background:#0f1118; color:var(--txt); border:1px solid rgba(255,255,255,.12);
      font-size:16px; outline:none;
    }
    .total{
      display:flex; align-items:center; justify-content:space-between;
      background:#0f1118; border:1px solid rgba(255,255,255,.12);
      border-radius:12px; padding:12px 14px; font-weight:600; margin-top:12px;
    }
    .total small{color:var(--muted); font-weight:500}

    /* Sekce 3 – QR */
    .qr-wrap{
      margin-top:20px; display:grid; gap:12px; place-items:center;
      padding:16px; border-radius:16px; background:#0f1118; border:1px solid rgba(255,255,255,.12);
    }
    .qr-box{ width:clamp(180px, 28vw, 320px); }
    .qr-box img{ display:block; width:100%; height:auto; border-radius:6px; background:#fff }
    .meta{ font-size:12px; color:var(--muted); text-align:center; word-break:break-all; max-width:720px }
    .grid2{ display:grid; gap:10px }
    @media (min-width:680px){ .grid2{ grid-template-columns:1fr auto } }

    .btns{ display:flex; gap:8px; flex-wrap:wrap; justify-content:center; margin-top:10px }
    button{
      appearance:none; cursor:pointer; font-weight:600; font-size:13px;
      padding:8px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.16);
      background:#151826; color:#fff;
    }
    .hint{font-size:12px; color:var(--muted); text-align:center}
    .bankline{font-feature-settings:"tnum" 1; font-variant-numeric: tabular-nums}
  </style>
</head>
<body>

  <!-- SEKCE 1: PLAKÁT -->
  <section class="hero">
    <img src="plakat.png" alt="Plakát" loading="lazy">
  </section>

  <!-- SEKCE 2: CENA + VÝBĚR POČTU -->
  <section class="panel">
    <div class="card">
      <h1>Cena lístku 200 Kč</h1>
      <p class="lead">Vyberte počet lístků, QR platba se dopočítá automaticky.</p>

      <label for="qty">Kolik chcete objednat lístků:</label>
      <select id="qty">
        <option value="1" selected>1 ks</option><option value="2">2 ks</option>
        <option value="3">3 ks</option><option value="4">4 ks</option>
        <option value="5">5 ks</option><option value="6">6 ks</option>
        <option value="7">7 ks</option><option value="8">8 ks</option>
        <option value="9">9 ks</option><option value="10">10 ks</option>
      </select>

      <div class="total">
        <div>Celkem k úhradě<br><small>200 Kč × <span id="qtty">1</span> ks</small></div>
        <div style="font-size:clamp(18px,2.6vw,28px)"><span id="sum">200</span> Kč</div>
      </div>

      <!-- SEKCE 3: QR PLATBA -->
      <div class="qr-wrap">
        <div class="qr-box">
          <img id="qrImg" alt="QR kód platby" width="320" height="320" decoding="async" />
        </div>

        <div class="grid2" style="align-items:center">
          <div class="bankline">
            <div><strong>Účet:</strong> 4373703073/0800</div>
            <div><strong>IBAN:</strong> CZ75&nbsp;0800&nbsp;0000&nbsp;0043&nbsp;7370&nbsp;3073</div>
            <div><strong>VS:</strong> 2025 &nbsp;|&nbsp; <strong>Měna:</strong> CZK</div>
            <div><strong>Zpráva:</strong> <span id="msg">Lístky 1 ks</span></div>
          </div>
          <div class="btns">
            <button id="dlQR" type="button">Stáhnout QR</button>
            <button id="copySPD" type="button">Kopírovat SPD</button>
          </div>
        </div>

        <div class="meta">
          <strong>Obsah (SPD):</strong>
          <div id="raw"></div>
        </div>
      </div>

      <p class="hint">QR je generováno jako obrázek přes veřejné API (goQR). Standard SPD 1.0 (CZ).</p>
    </div>
  </section>

<script>
/* ===== Zadání ===== */
const TICKET_PRICE = 200;
const IBAN = 'CZ7508000000004373703073'; // 4373703073/0800
const VARIABLE_SYMBOL = '2025';
const CURRENCY = 'CZK';

/* ===== Pomocné funkce ===== */
function amountCZK(qty){ return (Number(qty) * TICKET_PRICE).toFixed(2); }
function msgText(qty){ return `Lístky ${qty} ks`; }
function buildSPD({iban, amount, vs, msg}){
  const p = ['SPD*1.0'];
  p.push('ACC:'+iban);
  p.push('AM:'+amount);
  p.push('CC:'+CURRENCY);
  p.push('X-VS:'+vs);
  if(msg) p.push('MSG:'+msg.replace(/[\r\n]+/g,' ').slice(0,60));
  return p.join('*');
}

/* Vypočítá velikost pro API (px) dle šířky .qr-box, fallback 300 */
function qrSize(){
  const box = document.querySelector('.qr-box');
  const w = Math.round((box && box.getBoundingClientRect().width) || 300);
  return Math.max(180, Math.min(600, w)); // povolíme až 600px pro velké displeje
}

/* Nastaví <img src> na API URL s kódovaným SPD */
function setQRImage(spd){
  const size = qrSize();
  const url = `https://api.qrserver.com/v1/create-qr-code/?data=${encodeURIComponent(spd)}&size=${size}x${size}&margin=1`;
  const img = document.getElementById('qrImg');
  img.src = url;
  img.width = size; img.height = size;
}

/* Stáhne obsah <img> korektně i z cizí domény (fetch -> blob) */
async function downloadCurrentQR(){
  const img = document.getElementById('qrImg');
  try{
    const res = await fetch(img.src, {mode:'cors'});
    const blob = await res.blob();
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'qr-platba.png';
    document.body.appendChild(a);
    a.click();
    URL.revokeObjectURL(a.href);
    a.remove();
  }catch(e){
    // fallback – otevřít v nové záložce
    window.open(img.src, '_blank');
  }
}

/* ===== UI logika ===== */
const qtyEl  = document.getElementById('qty');
const sumEl  = document.getElementById('sum');
const qttyEl = document.getElementById('qtty');
const msgEl  = document.getElementById('msg');
const rawEl  = document.getElementById('raw');

function render(qty){
  const amount = amountCZK(qty);
  const spd = buildSPD({ iban: IBAN, amount, vs: VARIABLE_SYMBOL, msg: msgText(qty) });

  sumEl.textContent = (Number(amount)).toLocaleString('cs-CZ', { maximumFractionDigits: 0 });
  qttyEl.textContent = qty;
  msgEl.textContent = `Lístky ${qty} ks`;
  rawEl.textContent = spd;

  setQRImage(spd);
}

qtyEl.addEventListener('change', () => render(qtyEl.value));
window.addEventListener('resize', () => { clearTimeout(window._rT); window._rT = setTimeout(()=>render(qtyEl.value), 150); });

document.getElementById('dlQR').addEventListener('click', downloadCurrentQR);
document.getElementById('copySPD').addEventListener('click', async ()=>{
  try{ await navigator.clipboard.writeText(rawEl.textContent); alert('SPD zkopírováno do schránky.'); }
  catch{ alert('Nepodařilo se zkopírovat.'); }
});

/* Start */
render(qtyEl.value);
</script>
</body>
</html>
